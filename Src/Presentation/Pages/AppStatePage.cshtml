@page
@model Presentation.Pages.AppStatePageModel
@{
    ViewData["Title"] = "App State Page";
}

<h1>App State Management Demo</h1>

<div class="row">
    <div class="col-md-6">
        <component type="typeof(AppStateComponent)" render-mode="ServerPrerendered" param-AppState="Model.CurrentState" />
    </div>
    
    <div class="col-md-6 update-section">
        <h3>Update State</h3>
        <div class="add-number-section">
            <div class="form-group">
                <label for="newNumber">Add Number:</label>
                <input type="number" id="newNumber" class="form-control" placeholder="Enter a number" />
            </div>
            <button onclick="addNumber()" class="action-button mt-2">Add to State</button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        async function addNumber() {
            const input = document.getElementById('newNumber');
            const number = parseInt(input.value);
            
            if (isNaN(number)) {
                alert('Please enter a valid number');
                return;
            }
            
            try {
                const response = await fetch('/api/appstate/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                    },
                    body: JSON.stringify({ number: number })
                });
                
                if (response.ok) {
                    input.value = '';
                    console.log('Number added successfully');
                    // The component will be updated via the ComponentRenderingService
                } else {
                    console.error('Failed to add number');
                    alert('Failed to add number');
                }
            } catch (error) {
                console.error('Error adding number:', error);
                alert('Error adding number');
            }
        }
        
        // Allow Enter key to submit
        document.getElementById('newNumber').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addNumber();
            }
        });
    </script>
}